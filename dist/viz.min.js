function DefaultChartOptions(a,b,c,d,e){return{innercontainer:{height:c,width:d},chart:{type:e,height:a,width:b,margin:{top:20,right:20,bottom:40,left:55},x:function(a){return a.x},y:function(a){return a.y},useInteractiveGuideline:!0,dispatch:{stateChange:function(a){console.log("stateChange")},changeState:function(a){console.log("changeState")},tooltipShow:function(a){console.log("tooltipShow")},tooltipHide:function(a){console.log("tooltipHide")}},xAxis:{axisLabel:"Time (ms)"},yAxis:{axisLabel:"y",tickFormat:function(a){return d3.format(".02f")(a)},axisLabelDistance:-10},showLegend:!1,callback:function(a){}}}}function DefaultDashboard(a){return{title:"New dashboard",widgets:new IdIndexArray(a,function(a){console.log("[widgets] "+a+"--default removal--")}),mgrstate:{globalsettings:[{key:"__eId__",value:"??",isDynamic:!1}],globalsettingsname:"Global Settings",globalsettingschevron:!1,globalsettingsautorefresh:!1}}}function DefaultWidget(a,b,c,d,e,f){return{widgetWidth:"col-md-6",state:{title:"New dashlet",tabindex:0,data:{transformed:[],state:{}},shared:{presets:b,displaymode:a,options:new DefaultChartOptions(c,d,e,f,"lineChart"),config:{dashlettitle:"New Dashlet",autorefresh:"Off",barchevron:!0,master:!1,slave:!1,masterinput:"empty",slaveoutput:"empty too"},global:{},http:{}},query:{inputtype:"Raw",type:"Simple",datasource:{service:{method:"Get",controls:{}}}}}}}function IdIndexArray(a){if(!a)throw"Please provide array ref as argument.";return{array:a,getId:function(a){return a.oid},addNew:function(a){var b=getUniqueId();return a.oid=b,this.array.push(a),b},addExisting:function(a){this.array.push(a)},clear:function(){this.array.length=0},getById:function(a){var b=this.getIndexById(a);if(-1===b)throw"No object found with Id:"+a;return this.array[b]},getByIndex:function(a){return this.array[a]},getIndexById:function(a){for(i=0;i<this.array.length;i++)if(this.array[i].oid===a)return i;return-1},getIdByIndex:function(a){return this.array[a].oid},removeById:function(a){this.array.splice(this.getIndexById(a),1)},removeByIndex:function(a){this.getIdByIndex(a);this.array.splice(a,1)},copyById:function(a){var b=jsoncopy(this.getById(a));return b.oid=getUniqueId(),b},duplicateById:function(a){var b=this.addExisting(this.copyById(a)),c=this.getIndexById(b),d=this.getIndexById(a);this.moveFromToIndex(c,d+1)},moveFromToIndex:function(a,b){this.array.splice(b,0,this.array.splice(a,1)[0])},count:function(){return this.array.length},getPrevious:function(a){return this.getByIndex(this.getIndexById(a)-1)},getPreviousId:function(a){return this.getId(this.getPrevious(a))},getNext:function(a){return this.getByIndex(this.getIndexById(a)+1)},getNextId:function(a){return this.getId(this.getNext(a))},addIfAbsent:function(a){if(!a.oid)return this.addNew(a);var b=this.getIndexById(a.oid);return 0>b?this.addExisting(a):b},removeIfExists:function(a){if(!a)throw"Cant remove object without proper oid";var b=this.getIndexById(a);return 0>b?-1:this.removeByIndex(b)},removeAll:function(){console.log("[idindexarray] removeAll called. collection size:"+this.array.length);for(var a=0;a<this.array.length;a++)try{console.log("[ITERATION "+a+"]"),this.removeByIndex(a)}catch(b){console.log("error: "+b)}finally{console.log(a)}console.log("[idindexarray] removall finished.")},getAsArray:function(){return this.array}}}var productionmode=!0,productionFile="viz.js",devJSFolder="/js/",devTemplateFolder="/templates/",vizScripts={},registerScript=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src,c=b.split("/"),d=c[c.length-1];vizScripts[d]=b};registerScript();var resolveTemplateURL=function(a,b){return productionmode===!1?templateUrl=vizScripts[a].replace(devJSFolder,devTemplateFolder).replace(a,b)+"?who="+b+"&anticache="+getUniqueId():templateUrl=vizScripts[productionFile].replace(productionFile,"templates/"+b),templateUrl},setIntervalDefault=5e3,runResponseProc=function(postProc,response){return eval("("+postProc+")(response)")},runRequestProc=function(postProc,requestFragment,workData){return eval("("+postProc+")(requestFragment, workData)")},runValueFunction=function(functionFragment,value){return eval("(function(value){"+functionFragment+"})(value)")},runDynamicEval=function(expression){return eval(expression)},evalDynamic=function(a){var b=JSON.parse(JSON.stringify(a));return $.each(b,function(a,b){b.isDynamic&&(b.value=runDynamicEval(b.value))}),b},resolve=function(a,b){b=b.split(".");for(var c=a;b.length;){if("object"!=typeof c)return void 0;c=c[b.shift()]}return c},getUniqueId=function(){return Math.random().toString(36).substr(2,9)},jsoncopy=function(a){return JSON.parse(JSON.stringify(a))};registerScript(),angular.module("rtm-controls",[]).directive("rtmControls",function(){return{restrict:"E",scope:{state:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-controls.html"),controller:function(a,b){b.queryResult={abc:"def"}}}}),registerScript(),angular.module("viz-dashlet",["viz-query","dashletcomssrv"]).directive("vizDashlet",function(a){return{restrict:"E",scope:{options:"=",widgetid:"=",state:"="},templateUrl:resolveTemplateURL("viz-dashlet.js","viz-dashlet.html"),controller:function(a,b,c,d){a.selectTab=function(b){a.state.tabindex=b},a.isTabActive=function(b){return b===a.state.tabindex},a.toggleBarchevronToConf=function(){a.state.shared.config.barchevron=!a.state.shared.config.barchevron},a.toggleBarchevronToViz=function(){a.state.shared.config.slave||a.fireQuery(),a.state.shared.config.barchevron=!a.state.shared.config.barchevron},a.isOngoingQuery=!1,a.autorefreshInterval=null,a.fireQuery=function(){try{a.isOngoingQuery=!0;var b=a.state.query.datasource.service;b.params||(b.params=""),a.state.shared.http.servicesent="url :"+JSON.stringify(b.url+b.params)+"; payload:"+JSON.stringify(b.data),a.executeHttp(b.method,b.url+b.params,b.data,a.dispatchSuccessResponse,b,a.dispatchErrorResponse)}catch(c){console.log("exception thrown while firing query: "+c)}},a.dispatchAsync=function(a){console.log("async:"+JSON.stringify(a))},a.dispatchErrorResponse=function(b){console.log("error:"+JSON.stringify(b)),a.asyncInterval&&clearInterval(a.asyncInterval),a.isOngoingQuery=!1},a.executeHttp=function(a,b,d,e,f,g){console.log("executeHttp"),"Get"===a&&c.get(b).then(function(a){e(a,f)},function(a){g(a)}),"Post"===a&&c.post(b,d).then(function(a){e(a,f)},function(a){g(a)})},a.dispatchSuccessResponse=function(b,c){if(a.isOngoingQuery=!1,"Simple"===a.state.query.type&&a.loadData(b,c),"Async"===a.state.query.type){var d=a.state.query.datasource.callback;a.state.shared.http.rawserviceresponse=JSON.stringify(b),a.state.query.datasource.service.postproc.save&&(a.state.data.state=runResponseProc(a.state.query.datasource.service.postproc.save["function"],b));var e=d.data,f=d.url;d.preproc.replace&&("data"===d.preproc.replace.target?e=JSON.parse(runRequestProc(d.preproc.replace["function"],e,a.state.data.state)):"url"===d.preproc.replace.target&&(f=JSON.parse(runRequestProc(d.preproc.replace["function"],f,a.state.data.state)))),a.state.shared.http.callbacksent="url :"+JSON.stringify(f)+"; payload:"+JSON.stringify(e);var g=function(){a.executeHttp(d.method,f,e,a.loadData,d,a.dispatchErrorResponse)};a.asyncInterval=setInterval(g,setIntervalDefault),g()}},a.loadData=function(b,c){if("Simple"===a.state.query.type&&(a.state.shared.http.rawserviceresponse=JSON.stringify(b)),"Async"===a.state.query.type){if(a.asyncInterval)try{runResponseProc(a.state.query.datasource.callback.postproc.asyncEnd["function"],b)&&clearInterval(a.asyncInterval)}catch(d){console.log(d),clearInterval(a.asyncInterval)}a.state.shared.http.rawcallbackresponse=JSON.stringify(b)}a.state.data.transformed=runResponseProc(c.postproc.transform["function"],b)},a.loadDataAsSlave=function(b){a.state.data.transformed=b},a.$on("autorefresh-toggle",function(b,c){1==c.newValue?a.autorefreshInterval=setInterval(function(){if(!a.isOngoingQuery)try{a.fireQuery()}catch(b){console.log("exception thrown while firing query: "+b),a.isOngoingQuery=!1}},setIntervalDefault):clearInterval(a.autorefreshInterval)}),a.$on("templateph-loaded",function(){a.initPaging()}),a.$on("firenext",function(){console.log("firenext"),a.nextPaging(),a.fireQuery()}),a.$on("fireprevious",function(){console.log("fireprevious"),a.previousPaging(),a.fireQuery()}),a.initPaging=function(){var b=a.state.query.controls.template;b.paged&&b.paged.offsets&&b.paged.offsets.first&&(b.paged.offsets.first.state=runValueFunction(b.paged.offsets.first.start),console.log(b.paged.offsets.first.state),b.paged.offsets.second&&(b.paged.offsets.second.state=runValueFunction(b.paged.offsets.second.start)))},a.nextPaging=function(){var b=a.state.query.controls.template;console.log("firstState="+b.paged.offsets.first.state),b.paged.offsets.first.state=runValueFunction(b.paged.offsets.first.next,b.paged.offsets.first.state),console.log("newfirstState="+b.paged.offsets.first.state),b.paged.offsets.second.state=runValueFunction(b.paged.offsets.second.next,b.paged.offsets.second.state)},a.previousPaging=function(){var b=a.state.query.controls.template;b.paged.offsets.first.state=runValueFunction(b.paged.offsets.first.previous,b.paged.offsets.first.state),b.paged.offsets.second.state=runValueFunction(b.paged.offsets.second.previous,b.paged.offsets.second.state)}}}}),registerScript(),angular.module("viz-mgd-widget",["viz-dashlet"]).directive("vizMgdWidget",function(){return{restrict:"E",scope:{displaymode:"=",options:"=",widgetwidth:"=",widgetid:"=",state:"="},templateUrl:resolveTemplateURL("viz-mgd-widget.js","viz-mgd-widget.html"),controller:function(a,b){a.currentstate=JSON.parse(JSON.stringify(a.state)),a.state.shared.chevron=!0,a.state.shared.savedHeight=a.state.shared.options.innercontainer.height,a.state.shared.options.innercontainer.offset=50,a.dashlettitle=a.state.title,a.toggleChevron=function(){a.state.shared.chevron?a.collapse():a.restore(),a.state.shared.chevron=!a.state.shared.chevron},a.collapse=function(){a.state.shared.savedHeight=a.state.shared.options.innercontainer.height,a.state.shared.savedOffset=a.state.shared.options.innercontainer.offset,a.state.shared.options.innercontainer.height=30,a.state.shared.options.innercontainer.offset=0},a.restore=function(){a.state.shared.options.innercontainer.height=a.state.shared.savedHeight,a.state.shared.options.innercontainer.offset=a.state.shared.savedOffset},a.$on("dashlettitle-change",function(b,c){a.dashlettitle=c.newValue}),a.getActualDashletWidth=function(){return b[0].children[0].children[0].offsetWidth},$(window).on("resize",function(){a.resizeSingle()}),a.resizeSingle=function(){a.$emit("single-resize",{wid:a.widgetid,newsize:.8*a.getActualDashletWidth()})},a.emitExtend=function(){a.$emit("mgdwidget-extend",{wid:a.widgetid}),$(document).ready(function(){a.resizeSingle()})},a.emitReduce=function(){a.$emit("mgdwidget-reduce",{wid:a.widgetid}),$(document).ready(function(){a.resizeSingle()})},$(document).ready(function(){a.resizeSingle()}),a.removeWidget=function(){a.$emit("mgdwidget-remove",{wid:a.widgetid})}}}}),registerScript(),angular.module("viz-query",["nvd3","ui.bootstrap","key-val-collection","rtm-controls"]).directive("vizQuery",function(){return{restrict:"E",scope:{formwidth:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-query.html"),controller:function(a){}}}).directive("vizView",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-view.html"),controller:function(a){a.$watch("state.data.transformed",function(){"table"===a.state.shared.options.chart.type&&(a.tableData=a.toTable(a.state.data.transformed)),a.state.shared.options.chart.type.endsWith("Chart")&&(a.chartData=a.toChart(a.state.data.transformed))}),a.isPagingOff=function(){return a.state.query.controls&&a.state.query.controls.template&&a.state.query.paged.ispaged?"Off"===a.state.query.paged.ispaged:!0},a.stringToColour=function(a){var b=5e5*(a+1);a%2==0&&(b=100*b),b>>>=0;var c=255&b,d=(65280&b)>>>8,e=(16711680&b)>>>16;return"rgb("+[e,d,c].join(",")+")"},a.toChart=function(b){for(var c="x",d="y",e="z",f=[],g={},h=b,i=0;i<h.length;i++){var j=h[i][e];j in g||(f.push({values:[],key:j,color:a.stringToColour(i),strokeWidth:3,classed:"dashed"}),g[j]=f.length-1),f[g[j]].values.push({x:h[i][c],y:h[i][d]})}return f},a.toTable=function(a){for(var b="x",c="y",d="z",e=[],f={},g=[],h=a,i=0;i<h.length;i++){var j=h[i][b];j in f||(e.push({values:{},x:j}),f[j]=e.length-1),e[f[j]].values[h[i][d]]=h[i][c],g.includes(h[i][d])||g.push(h[i][d])}return{zlist:g.sort(),data:e}}}}}).directive("vizTransform",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-transform.html"),controller:function(a){}}}).directive("vizConfig",function(a){return{restrict:"E",scope:{formwidth:"=",widgetid:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-config.html"),controller:function(b){b.state.shared.config.dashlettitle=b.state.title,b.$on("globalsettings-refreshToggle",function(a,c){c["new"]?b.state.shared.config.slave||(b.state.shared.config.autorefresh="On"):b.state.shared.config.autorefresh="Off"}),b.loadConfigPreset=function(a){b.currentconfig=a,b.state.shared.config=$scurrentconfig},b.loadMaster=function(a){b.$emit("master-loaded",a)},b.titleChange=function(){b.$emit("dashlettitle-change",{newValue:b.state.shared.config.dashlettitle})},b.titleChange(),b.undoMaster=function(){console.log(b.widgetid+": undoMaster"),a.unregisterWidget(b.widgetid),b.unwatchMaster&&b.unwatchMaster()},b.undoSlave=function(){b.unwatchSlave&&b.unwatchSlave()},b.$on("coms-reset",function(){b.state.shared.config.master&&(b.state.shared.config.master=!b.state.shared.config.master),b.undoMaster(),b.state.shared.config.slave&&(b.state.shared.config.slave=!b.state.shared.config.slave),b.undoSlave()}),b.$on("isMaster-changed",function(c,d){d?b.undoMaster():(console.log("registering dashlet with id:"+b.widgetid),a.registerWidget(b.widgetid,b.state.shared.config.dashlettitle),b.unwatchMaster=b.$watch("state.data.transformed",function(c){a.updateMasterValue(b.widgetid,angular.toJson(c))}))}),b.$watch("state.shared.config.dashlettitle",function(c){b.state.shared.config.master&&a.udpdateTitle(b.widgetid,c)}),b.unwatchSlave="",b.startWatchingMaster=function(c){if(b.state.shared.config.slave){var d=b.$watch(function(){return a.buffer[c]},function(a){console.log("newValue"),console.log(a),b.state.data.transformed=JSON.parse(a)});b.unwatchSlave=d}},b.$watch("state.shared.config.slave",function(a){a||b.undoSlave()}),b.$on("master-loaded",function(a,c){b.undoSlave(),b.state.shared.config.currentmaster=c,b.startWatchingMaster(c.oid)}),b.$watch(function(){return a.masters},function(a){b.state.shared.config.masters=a}),b.$on("single-remove",function(a,c){c===b.widgetid&&(console.log("single-remove targeting "+c+" was received."),b.prepareRemove())}),b.$on("global-remove",function(a,c){b.prepareRemove()}),b.prepareRemove=function(){console.log("prepareRemove called."),b.state.shared.config.master&&a.unregisterWidget(b.widgetid)},b.state.shared.config.currentmaster&&b.startWatchingMaster(b.state.shared.config.currentmaster.oid),b.state.shared.config.master&&a.registerWidget(b.widgetid,b.state.shared.config.dashlettitle)}}}).directive("vizInfo",function(){return{restrict:"E",scope:{formwidth:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-info.html"),controller:function(a){}}}).directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return JSON.parse(a)}function f(a){return JSON.stringify(a)}d.$parsers.push(e),d.$formatters.push(f)}}}).directive("vizQService",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-service.html"),controller:function(a){}}}).directive("vizQInput",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-input.html"),controller:function(a){a.globalsettings=[],a.loadQueryPreset=function(b){a.state.query=b.query},a.$on("key-val-collection-change-Placeholders",function(b,c){a.templateplaceholders=c.collection,a.change(!1)}),a.processTemplate=function(b){var c=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedPayload,evalDynamic(a.mergePlaceholders())),d=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedParams,evalDynamic(a.mergePlaceholders()));return{data:c,params:d}},a.$on("globalsettings-change",function(b,c){a.globalsettings=c.collection,a.state.query.controls.template&&a.change(c.async)}),a.mergePlaceholders=function(b){var c=JSON.parse(JSON.stringify(a.state.query.controls.template.placeholders)),d=JSON.parse(JSON.stringify(a.globalsettings)),e=[];return console.log(a.state),a.state.query.controls.template&&"On"===a.state.query.paged.ispaged&&(e.push({key:a.state.query.paged.offsets.first.vid,value:a.state.query.paged.offsets.first.state}),e.push({key:a.state.query.paged.offsets.second.vid,value:a.state.query.paged.offsets.second.state})),console.log("merging paging:"),console.log(e),d.concat(c).concat(e)},a.loadTemplatePreset=function(b){a.state.query=b.queryTemplate,a.state.query.controls||(a.state.query.controls={template:{}}),a.state.query.controls.template.templatedPayload=b.templatedPayload,a.state.query.controls.template.templatedParams=b.templatedParams,a.state.query.controls.template.placeholders=b.placeholders,a.$emit("templateph-loaded")},a.change=function(b){var c=a.processTemplate();a.state.query.datasource.service.data=c.data,a.state.query.datasource.service.params=c.params}}}}).directive("vizQPreproc",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-preproc.html"),controller:function(a){}}}).directive("vizQPostproc",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-postproc.html"),controller:function(a){}}}),registerScript(),angular.module("viz-dashboard",["viz-mgd-widget","ui.bootstrap","dashletcomssrv"]).directive("vizDashboard",function(){return{restrict:"E",scope:{dashboard:"=",dashboardid:"=",displaymode:"=",presets:"=",mgrstate:"="},templateUrl:resolveTemplateURL("viz-dashboard.js","viz-dashboard.html"),controller:function(a,b){a.wwrap=a.dashboard.widgets,a.mgrstate.globalsettingsautorefresh&&a.toggleAutorefresh(),a.toggleAutorefresh=function(){a.mgrstate.globalsettingsautorefresh=!a.mgrstate.globalsettingsautorefresh,a.mgrstate.globalsettingsautorefresh?a.addInterval():a.removeInterval(),a.$broadcast("globalsettings-refreshToggle",{"new":a.mgrstate.globalsettingsautorefresh})},a.addInterval=function(){a.mgrstate.gsautorefreshInterval=setInterval(function(){a.$broadcast("globalsettings-change",{collection:a.mgrstate.globalsettings,async:!0})},setIntervalDefault)},a.removeInterval=function(){clearInterval(a.mgrstate.gsautorefreshInterval)},a.$on("key-val-collection-change-Global Settings",function(b,c){c.async=!1,a.$broadcast("globalsettings-change",c)}),a.toggleChevron=function(){a.mgrstate.globalsettingschevron=!a.mgrstate.globalsettingschevron},a.$on("mgdwidget-reduce",function(b,c){var d=a.wwrap.getById(c.wid);d.widgetWidth="col-md-6";var e=d.state.shared.options;e.chart.height=a.chartHeightSmall,e.chart.width=a.chartWidthSmall,e.innercontainer.height=a.innerContainerHeightSmall,e.innercontainer.width=a.innerContainerWidthSmall}),a.$on("mgdwidget-extend",function(b,c){var d=a.wwrap.getById(c.wid);d.widgetWidth="col-md-12";var e=d.state.shared.options;e.chart.height=a.chartHeightBig,e.chart.width=a.chartWidthBig,e.innercontainer.height=a.innerContainerHeightBig,e.innercontainer.width=a.innerContainerWidthBig}),a.$on("mgdwidget-remove",function(c,d){b.unregisterWidget(d.wid),a.wwrap.removeById(d.wid)}),a.$on("mgdwidget-moveLeft",function(b,c){var d=a.wwrap.getIndexById(c.wid);d>0&&a.wwrap.moveFromToIndex(d,d-1)}),a.$on("mgdwidget-moveRight",function(b,c){var d=a.wwrap.getIndexById(c.wid);d<a.wwrap.count()-1&&a.wwrap.moveFromToIndex(d,d+1)}),a.$on("mgdwidget-duplicate",function(b,c){a.wwrap.duplicateById(c.wid)}),a.$on("clearwidgets",function(b,c){a.dashboardid===c.dashboardid&&a.wwrap.clear()}),a.$on("addwidget",function(b,c){if(a.dashboardid===c.dashboardid){a.wwrap.addNew(new DefaultWidget(a.displaymode,a.presets,a.chartHeightSmall,a.chartWidthSmall,a.innerContainerHeightSmall,a.innerContainerWidthSmall))}}),a.computeHeights=function(){var b=window.innerHeight;a.headersHeight=250,a.chartToContainer=35,a.chartHeightSmall=(b-a.headersHeight)/2-a.chartToContainer,a.chartHeightBig=b-(a.headersHeight-80)-a.chartToContainer,a.chartWidthSmall=0,a.chartWidthBig=0,a.innerContainerHeightSmall=(b-a.headersHeight)/2,a.innerContainerHeightBig=b-(a.headersHeight-80),a.innerContainerWidthSmall=0,a.innerContainerWidthBig=0},a.computeHeights(),a.$on("single-resize",function(b,c){$(document).ready(function(){a.updateSingleChartSize(c.wid,c.newsize)})}),a.updateSingleChartSize=function(b,c){a.computeHeights();var d=a.wwrap.getById(b),e=d.state.shared.options;e.chart.width=c,e.innercontainer.width=c-50,"col-md-6"===d.widgetWidth?(e.chart.height=a.chartHeightSmall,e.innercontainer.height=a.innerContainerHeightSmall):(e.chart.height=a.chartHeightBig,e.innercontainer.height=a.innerContainerHeightBig),a.forceRedraw()},a.forceRedraw=function(){a.$apply(function(){self.value=0})},a.$emit("dashboard-ready")}}}),registerScript(),angular.module("viz-dashboard-manager",["viz-dashboard","ui.bootstrap","dashletcomssrv"]).directive("vizDashboardManager",function(){return{restrict:"E",scope:{presets:"=",dashboards:"=",displaymode:"="},templateUrl:resolveTemplateURL("viz-dashboard.js","viz-dashboard-manager.html"),controller:function(a,b){a.dwrap=new IdIndexArray(a.dashboards),a.dashboards.length>0&&a.dashboards[0]&&a.dashboards[0].oid&&(a.mgrtabstate=a.dashboards[0].oid),a.selectTab=function(b){a.mgrtabstate=b},a.isTabActive=function(b){return b===a.mgrtabstate},a.$on("removeDashboard",function(c,d){a.mgrtabstate===d&&(a.dwrap.getIndexById(a.mgrtabstate)>0?a.mgrtabstate=a.dwrap.getPreviousId(a.mgrtabstate):a.dwrap.getIndexById(a.mgrtabstate)<a.dwrap.count()-1?a.mgrtabstate=a.dwrap.getNextId(a.mgrtabstate):a.mgrtabstate=null),$.each(a.dwrap.getById(d).widgets.getAsArray(),function(a,c){b.unregisterWidget(c.oid)}),a.dwrap.removeById(d)}),a.$on("dashboard-new",function(b,c){a.dwrap.addNew(new DefaultDashboard([])),a.mgrtabstate=a.dwrap.getId(a.dwrap.getByIndex(a.dwrap.count()-1))}),a.$on("dashboard-clear",function(){a.dwrap.clear()}),a.$on("dashboard-current-addWidget",function(){a.$broadcast("addwidget",{dashboardid:a.mgrtabstate})}),a.$on("dashboard-current-clearWidgets",function(){a.$broadcast("clearwidgets",{dashboardid:a.mgrtabstate})}),a.$emit("manager-ready")}}}),registerScript(),angular.module("key-val-collection",["ui.bootstrap"]).directive("keyValCollection",function(){return{restrict:"E",scope:{collection:"=",collectionname:"="},templateUrl:resolveTemplateURL("key-val-collection.js","key-val-collection.html"),controller:function(a){a.getNumber=function(a){return new Array(a)},a.addElement=function(){a.collection.push({key:"__?__",value:"?",isDynamic:!1}),a.changed()},a.removeElement=function(b){a.collection.splice(b,1),a.changed()},a.changed=function(b,c){a.$emit("key-val-collection-change-"+a.collectionname,{type:c,element:b,collection:a.collection})},a.$on("force-update-"+a.collectionname,function(b,c){a.$emit("key-val-collection-change-"+a.collectionname,{type:"forced",element:null,collection:a.collection})})}}}),registerScript(),angular.module("dashletcomssrv",[]).service("dashletcomssrv",function(a){var b={};return b.buffer={},b.masters={},b.masters.array=[],b.masters=new IdIndexArray(b.masters.array,function(a){}),b.registerWidget=function(a,c){console.log("[dashletcomssrv] registering "+a),b.masters.addIfAbsent({oid:a,title:c})},b.udpdateTitle=function(a,c){b.masters.getById(a).title=c},b.unregisterWidget=function(a){console.log("[dashletcomssrv] unregistering "+a),b.masters.removeIfExists(a)},b.updateMasterValue=function(a,c){b.buffer[a]=c},b});