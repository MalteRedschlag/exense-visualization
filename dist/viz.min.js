function DefaultChartOptions(a,b,c,d,e){return{innercontainer:{height:c,width:d},chart:{type:e,height:a,width:b,margin:{top:20,right:20,bottom:40,left:55},x:function(a){return a.x},y:function(a){return a.y},useInteractiveGuideline:!0,dispatch:{stateChange:function(a){console.log("stateChange")},changeState:function(a){console.log("changeState")},tooltipShow:function(a){console.log("tooltipShow")},tooltipHide:function(a){console.log("tooltipHide")}},xAxis:{axisLabel:"Time (ms)"},yAxis:{axisLabel:"y",tickFormat:function(a){return d3.format(".02f")(a)},axisLabelDistance:-10},showLegend:!1,callback:function(a){}}}}var productionmode=!1,productionFile="viz.js",devJSFolder="/js/",devTemplateFolder="/templates/",vizScripts={},registerScript=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src,c=b.split("/"),d=c[c.length-1];vizScripts[d]=b};registerScript();var resolveTemplateURL=function(a,b){return productionmode===!1?templateUrl=vizScripts[a].replace(devJSFolder,devTemplateFolder).replace(a,b)+"?who="+b+"&anticache="+getUniqueId():templateUrl=vizScripts[productionFile].replace(productionFile,"templates/"+b),templateUrl},resolve=function(a,b){b=b.split(".");for(var c=a;b.length;){if("object"!=typeof c)return void 0;c=c[b.shift()]}return c},getUniqueId=function(){return Math.random().toString(36).substr(2,9)};registerScript(),angular.module("rtm-controls",[]).directive("rtmControls",function(){return{restrict:"E",scope:{state:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-controls.html"),controller:function(a,b){b.queryResult={abc:"def"}}}}),registerScript(),angular.module("viz-dashlet",["viz-query"]).directive("vizDashlet",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-dashlet.js","viz-dashlet.html"),controller:function(a,b){a.redraw="drawn",a.toggleBarchevronToConf=function(){a.state.shared.config.barchevron=!a.state.shared.config.barchevron},a.toggleBarchevronToViz=function(){a.$broadcast("child-firequery",{}),a.state.shared.config.barchevron=!a.state.shared.config.barchevron},a.$on("autorefresh-toggle",function(b,c){a.$broadcast("child-autorefresh-toggle",c)}),a.$on("firequery",function(b,c){a.$broadcast("child-firequery",c)})}}}),registerScript(),angular.module("viz-mgd-widget",["viz-dashlet"]).directive("vizMgdWidget",function(){return{restrict:"E",scope:{options:"=",widgetwidth:"=",dashboardid:"=",widgetid:"=",state:"="},templateUrl:resolveTemplateURL("viz-mgd-widget.js","viz-mgd-widget.html"),controller:function(a,b){a.currentstate=JSON.parse(JSON.stringify(a.state)),a.state.shared.chevron=!0,a.state.shared.savedHeight=a.state.shared.options.innercontainer.height,a.state.shared.options.innercontainer.offset=50,a.dashlettitle="Dashlet title",a.toggleChevron=function(){a.state.shared.chevron?a.collapse():a.restore(),a.state.shared.chevron=!a.state.shared.chevron},a.collapse=function(){a.state.shared.savedHeight=a.state.shared.options.innercontainer.height,a.state.shared.savedOffset=a.state.shared.options.innercontainer.offset,a.state.shared.options.innercontainer.height=30,a.state.shared.options.innercontainer.offset=0},a.restore=function(){a.state.shared.options.innercontainer.height=a.state.shared.savedHeight,a.state.shared.options.innercontainer.offset=a.state.shared.savedOffset},a.$on("dashlet-title",function(b,c){a.dashlettitle=c.newValue}),a.getActualDashletWidth=function(){return b[0].children[0].children[0].offsetWidth},$(window).on("resize",function(){a.resizeSingle()}),a.resizeSingle=function(){a.$emit("single-resize",{did:a.dashboardid,wid:a.widgetid,newsize:.8*a.getActualDashletWidth()})},a.emitExtend=function(){a.$emit("mgdwidget-extend",{wid:a.widgetid}),$(document).ready(function(){a.resizeSingle()})},a.emitReduce=function(){a.$emit("mgdwidget-reduce",{wid:a.widgetid}),$(document).ready(function(){a.resizeSingle()})},$(document).ready(function(){a.resizeSingle()})}}}),registerScript(),angular.module("viz-query",["nvd3","ui.bootstrap","rtm-controls"]).directive("vizQuery",function(){return{restrict:"E",scope:{formwidth:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-query.html"),controller:function(a){a.$on("templatePhChange",function(){a.state.query.datasource.service.data=JSON.parse(a.runRequestProc(a.state.query.datasource.service.controls.template.datasource.service.preproc.replace["function"],JSON.stringify(a.state.query.datasource.service.controls.template.datasource.service.data),a.state.query.datasource.service.controls.placeholders))})}}}).directive("vizView",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-view.html"),controller:function(a){a.$watch("state.data.transformed",function(){"table"===a.state.shared.options.chart.type&&(a.tableData=a.toTable(a.state.data.transformed)),a.state.shared.options.chart.type.endsWith("Chart")&&(a.chartData=a.toChart(a.state.data.transformed))}),a.stringToColour=function(a){var b=5e5*(a+1);a%2==0&&(b=100*b),b>>>=0;var c=255&b,d=(65280&b)>>>8,e=(16711680&b)>>>16;return"rgb("+[e,d,c].join(",")+")"},a.toChart=function(b){for(var c="x",d="y",e="z",f=[],g={},h=b,i=0;i<h.length;i++){var j=h[i][e];j in g||(f.push({values:[],key:j,color:a.stringToColour(i),strokeWidth:3,classed:"dashed"}),g[j]=f.length-1),f[g[j]].values.push({x:h[i][c],y:h[i][d]})}return f},a.toTable=function(a){for(var b="x",c="y",d="z",e=[],f={},g=[],h=a,i=0;i<h.length;i++){var j=h[i][b];j in f||(e.push({values:{},x:j}),f[j]=e.length-1),e[f[j]].values[h[i][d]]=h[i][c],g.includes(h[i][d])||g.push(h[i][d])}return{zlist:g.sort(),data:e}}}}}).directive("vizTransform",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-transform.html"),controller:function($scope,$http){$scope.counter=0,$scope.queryFire=!1,$scope.isOngoingQuery=!1,$scope.autorefreshInterval=null,$scope.$on("child-firequery",function(a,b){$scope.fireQuery()}),$scope.$on("child-autorefresh-toggle",function(a,b){1==b.newValue?$scope.autorefreshInterval=setInterval(function(){if(!$scope.isOngoingQuery)try{$scope.fireQuery()}catch(a){console.log("exception thrown while firing query: "+a),$scope.isOngoingQuery=!1}},1e3):clearInterval($scope.autorefreshInterval)}),$scope.fireQuery=function(){try{$scope.isOngoingQuery=!0,$scope.counter++;var a=$scope.state.query.datasource.service;$scope.state.shared.http.servicesent="url :"+JSON.stringify(a.url)+"; payload:"+JSON.stringify(a.data),$scope.executeHttp(a.method,a.url,a.data,$scope.dispatchSuccessResponse,a,$scope.dispatchErrorResponse)}catch(b){console.log("exception thrown while firing query: "+b)}},$scope.dispatchAsync=function(a){console.log("async:"+JSON.stringify(a))},$scope.dispatchErrorResponse=function(a){console.log("error:"+JSON.stringify(a)),$scope.asyncInterval&&clearInterval($scope.asyncInterval),$scope.isOngoingQuery=!1},$scope.executeHttp=function(a,b,c,d,e,f){"Get"===a&&$http.get(b).then(function(a){d(a,e)},function(a){f(a)}),"Post"===a&&$http.post(b,c).then(function(a){d(a,e)},function(a){f(a)})},$scope.dispatchSuccessResponse=function(a,b){if($scope.isOngoingQuery=!1,"Simple"===$scope.state.query.type&&$scope.loadData(a,b),"Async"===$scope.state.query.type){var c=$scope.state.query.datasource.callback;$scope.state.shared.http.rawserviceresponse=JSON.stringify(a),$scope.state.query.datasource.service.postproc.save&&($scope.state.data.state=$scope.runResponseProc($scope.state.query.datasource.service.postproc.save["function"],a));var d=c.data,e=c.url;c.preproc.replace&&("data"===c.preproc.replace.target?d=JSON.parse($scope.runRequestProc(c.preproc.replace["function"],JSON.stringify(d),$scope.state.data.state)):"url"===c.preproc.replace.target&&(e=JSON.parse($scope.runRequestProc(c.preproc.replace["function"],JSON.stringify(e),$scope.state.data.state)))),$scope.state.shared.http.callbacksent="url :"+JSON.stringify(e)+"; payload:"+JSON.stringify(d),$scope.asyncInterval=setInterval(function(){$scope.executeHttp(c.method,e,d,$scope.loadData,c,$scope.dispatchErrorResponse)},1e3)}},$scope.loadData=function(a,b){if("Simple"===$scope.state.query.type&&($scope.state.shared.http.rawserviceresponse=JSON.stringify(a)),"Async"===$scope.state.query.type){if($scope.asyncInterval)try{$scope.runResponseProc($scope.state.query.datasource.callback.postproc.asyncEnd["function"],a)&&clearInterval($scope.asyncInterval)}catch(c){console.log(c),clearInterval($scope.asyncInterval)}$scope.state.shared.http.rawcallbackresponse=JSON.stringify(a)}$scope.state.data.transformed=$scope.runResponseProc(b.postproc.transform["function"],a)},$scope.runResponseProc=function(postProc,response){return eval("("+postProc+")(response)")},$scope.runRequestProc=function(postProc,requestFragment,workData){return eval("("+postProc+")(requestFragment, workData)")}}}}).directive("vizConfig",function(){return{restrict:"E",scope:{formwidth:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-config.html"),controller:function(a,b){a.currentconfig=a.state.shared.config,a.loadConfigPreset=function(b){a.currentconfig=b,a.state.shared.config=$scurrentconfig}}}}).directive("vizInfo",function(){return{restrict:"E",scope:{formwidth:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-info.html"),controller:function(a,b){}}}).directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return JSON.parse(a)}function f(a){return JSON.stringify(a)}d.$parsers.push(e),d.$formatters.push(f)}}}).directive("vizQService",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-service.html"),controller:function(a){}}}).directive("vizQInput",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-input.html"),controller:function(a){a.initTemplateControls=function(){a.state.query.datasource.service.controls={template:"",placeholders:{}},a.getNumber=function(a){return new Array(a)}},a.addPlaceholder=function(){a.state.query.datasource.service.controls.placeholders.push({placeholder:"__?__",value:"?",isDynamic:!1})},a.removePlaceholder=function(b){a.state.query.datasource.service.controls.placeholders.splice(b,1)},a.loadQueryPreset=function(b){a.state.query=b.query,a.$emit("querychange")},a.loadTemplatePreset=function(b){a.state.query.datasource.service.controls.template=b.queryTemplate,a.state.query.datasource.service.controls.placeholders=b.placeholders}}}}).directive("vizQPreproc",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-preproc.html"),controller:function(a){}}}).directive("vizQPostproc",function(){return{restrict:"E",scope:{options:"=",state:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-postproc.html"),controller:function(a){}}}),angular.module("wmservice",[]).service("wmservice",function(a){var b={};return b.dashboards=[],b.computeHeights=function(){var a=window.innerHeight;b.headersHeight=250,b.chartToContainer=15,b.chartHeightSmall=(a-b.headersHeight)/2-b.chartToContainer,b.chartHeightBig=a-(b.headersHeight-80)-b.chartToContainer,b.chartWidthSmall=0,b.chartWidthBig=0,b.innerContainerHeightSmall=(a-b.headersHeight)/2,b.innerContainerHeightBig=a-(b.headersHeight-80),b.innerContainerWidthSmall=0,b.innerContainerWidthBig=0},b.computeHeights(),b.forceRedraw=function(){a.$apply(function(){self.value=0})},b.getNewId=function(){return Math.random().toString(36).substr(2,9)},b.addDashboard=function(){var a=b.getNewId();return b.dashboards.push({title:"New dashboard",widgets:[],dashboardid:a}),a},b.clearDashboards=function(){b.dashboards.length=0},b.clearWidgets=function(a){b.getDashboardById(a).widgets.length=0},b.getWidget=function(a,c){var d=b.getDashboardById(a).widgets;for(i=0;i<d.length;i++)if(d[i].widgetId===c)return d[i];return null},b.updateSingleChartSize=function(a,c,d){b.computeHeights();var e=b.getWidget(a,c);e.state.shared.options.chart.width=d,e.state.shared.options.innercontainer.width=d-50,"col-md-6"===e.widgetWidth?(e.state.shared.options.chart.height=b.chartHeightSmall,e.state.shared.options.innercontainer.height=b.innerContainerHeightSmall):(e.state.shared.options.chart.height=b.chartHeightBig,e.state.shared.options.innercontainer.height=b.innerContainerHeightBig),b.forceRedraw()},b.extendWidget=function(a,c){var d=b.getWidget(a,c);d.widgetWidth="col-md-12",d.state.shared.options.chart.height=b.chartHeightBig,d.state.shared.options.chart.width=b.chartWidthBig,d.state.shared.options.innercontainer.height=b.innerContainerHeightBig,d.state.shared.options.innercontainer.width=b.innerContainerWidthBig},b.reduceWidget=function(a,c){var d=b.getWidget(a,c);d.widgetWidth="col-md-6",d.state.shared.options.chart.height=b.chartHeightSmall,d.state.shared.options.chart.width=b.chartWidthSmall,d.state.shared.options.innercontainer.height=b.innerContainerHeightSmall,d.state.shared.options.innercontainer.width=b.innerContainerWidthSmall},b.addWidget=function(a,c){wId=b.getNewId(),widget={widgetId:wId,widgetWidth:"col-md-6",title:"Dashlet title",state:{tabindex:0,data:{transformed:[],state:{}},shared:{presets:c,options:new DefaultChartOptions(b.chartHeightSmall,b.chartWidthSmall,b.innerContainerHeightSmall,b.innerContainerWidthSmall,"lineChart"),config:{autorefresh:"Off",barchevron:!0},http:{}},query:{inputtype:"Raw",type:"Simple",datasource:{service:{method:"Get",controls:{}}}}}},b.getDashboardById(a).widgets.push(widget)},b.removeWidget=function(a,c){var d=b.getDashboardById(a).widgets;for(i=0;i<d.length;i++)d[i].widgetId===c&&d.splice(i,1)},b.getWidgetIndex=function(a,c){return b.getObjectIndexFromArray(b.getDashboardById(a).widgets,"widgetId",c)},b.getDashboardIndex=function(a){return b.getObjectIndexFromArray(b.dashboards,"dashboardid",a)},b.getDashboardById=function(a){return b.dashboards[b.getDashboardIndex(a)]},b.removetDashboardById=function(a){b.dashboards.splice(b.getDashboardIndex(a),1)},b.getObjectIndexFromArray=function(a,b,c){for(i=0;i<a.length;i++)if(a[i][b]===c)return i},b.moveWidget=function(a,c,d){var e=b.getDashboardById(a).widgets;if(d>=e.length)for(var f=d-e.length+1;f--;)arr.push(void 0);e.splice(d,0,e.splice(c,1)[0])},b.moveWidgetLeft=function(a,c){var d=b.getWidgetIndex(a,c);d>0&&b.moveWidget(a,d,d-1)},b.moveWidgetRight=function(a,c){var d=b.getWidgetIndex(a,c);b.moveWidget(a,d,d+1)},b.duplicateWidget=function(a,c){var d=b.getWidgetCopy(a,c);b.getDashboardById(a).widgets.push(d),b.moveWidget(a,b.getWidgetIndex(a,d.widgetId),b.getWidgetIndex(a,c)+1)},b.getWidgetCopy=function(a,c){var d=JSON.parse(JSON.stringify(b.getWidget(a,c)));return d.widgetId=b.getNewId(),d},b}),registerScript(),angular.module("viz-widget-manager",["wmservice","viz-mgd-widget","ui.bootstrap"]).directive("vizDashboardManager",function(a){return{restrict:"E",scope:{presets:"="},templateUrl:resolveTemplateURL("viz-widget-manager.js","viz-dashboard-manager.html"),controller:function(a,b){a.dashboards=b.dashboards,a.$on("dashboard-reload",function(){a.dashboards=b.dashboards}),b.dashboards.length>0&&(a.mgrtabstate=b.dashboards[0].dashboardid),a.selectTab=function(b){a.mgrtabstate=b},a.isTabActive=function(b){return b===a.mgrtabstate},a.$on("removeDashboard",function(c,d){if(a.mgrtabstate===d)if(b.getDashboardIndex(a.mgrtabstate)>0){var e=b.dashboards[b.getDashboardIndex(a.mgrtabstate)-1].dashboardid;a.mgrtabstate=e,a.savedState=a.mgrtabstate}else if(b.getDashboardIndex(a.mgrtabstate)<b.dashboards.length-1){var f=b.dashboards[b.getDashboardIndex(a.mgrtabstate)+1].dashboardid;a.mgrtabstate=f,a.savedState=a.mgrtabstate}b.removetDashboardById(d)}),a.saveState=function(){a.savedState=a.mgrtabstate},a.$on("single-resize",function(a,c){$(document).ready(function(){b.updateSingleChartSize(c.did,c.wid,c.newsize)})}),a.$on("dashboard-new",function(c,d){b.addDashboard(),a.mgrtabstate=a.dashboards[a.dashboards.length-1].dashboardid}),a.$on("dashboard-clear",function(){b.clearDashboards()}),a.$on("dashboard-current-addWidget",function(){b.addWidget(a.mgrtabstate,a.presets)}),a.$on("dashboard-current-clearWidgets",function(){b.clearWidgets(a.mgrtabstate)}),a.$emit("dashboard-ready")}}}).directive("vizWidgetManager",function(){return{restrict:"E",scope:{dashboard:"=",presets:"="},templateUrl:resolveTemplateURL("viz-widget-manager.js","viz-widget-manager.html"),controller:function(a,b){a.widgets=a.dashboard.widgets,a.$on("mgdwidget-reduce",function(c,d){b.reduceWidget(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-extend",function(c,d){b.extendWidget(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-remove",function(c,d){b.removeWidget(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-moveLeft",function(c,d){b.moveWidgetLeft(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-moveRight",function(c,d){b.moveWidgetRight(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-duplicate",function(c,d){b.duplicateWidget(a.dashboard.dashboardid,d.wid)}),a.$on("mgdwidget-refresh",function(a,b){})}}});