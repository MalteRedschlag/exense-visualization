function Dashboard(a,b){return{oid:a,dstate:b}}function Widget(a,b,c){return{oid:a,wstate:b,state:c}}function Dashlet(a,b){return{oid:a,state:b}}function WidgetState(a,b,c){return{widgetwidth:a,autorefresh:b,chevron:c}}function Info(a){return{showraw:a,alert:{message:"",counter:0},http:{}}}function Gui(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return{status:{open:{presets:a,loadconfig:b,display:c,coms:d,subscribeto:e,execution:f,info:g,presetquery:h,presetcontrols:i,service:j,input:k,preproc:l,postproc:m,manage:n},disabled:{manage:!1}}}}function DashletState(a,b,c,d,e,f,g,h,i){return{title:a,viewtoggle:b,tabindex:c,data:d,options:{innercontainer:{height:0,width:0},chart:e},config:f,global:{},info:i,gui:h,query:g}}function DashletData(a,b,c){return{transformed:a,rawresponse:b,state:c}}function Config(a,b,c,d,e,f){return{autorefresh:a,master:b,slave:c,target:d,autorefreshduration:e,asyncrefreshduration:f}}function DashboardState(a,b,c,d,e){return{globalsettings:a,widgets:b,title:c,displaytype:d,dashboardgui:e}}function DashboardGui(a){return{inputopen:a}}function GlobalSettings(a,b,c,d,e){return{placeholders:a,autorefresh:b,chevron:c,name:d,intervalduration:e}}function ChartOptions(a,b,c){return"stackedAreaChart"===a?{type:"stackedAreaChart",height:window.innerHeight/4,width:0,margin:{top:20,right:20,bottom:50,left:55},useVoronoi:!1,showControls:!1,clipEdge:!0,duration:0,useInteractiveGuideline:!0,showLegend:!1,xAxis:{showMaxMin:!1,tickFormat:function(a){return formatPotentialTimestamp(a)},rotateLabels:-25},forceY:0,yAxis:{},zoom:{enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!0,verticalOff:!0,unzoomEventType:"dblclick.zoom"}}:{type:a,height:window.innerHeight/4,width:0,margin:{top:20,right:20,bottom:50,left:55},stacked:c,useInteractiveGuideline:b,x:function(a){return a.x},y:function(a){return a.y},showLegend:!1,scatter:{onlyCircles:!1},forceY:0,xAxis:{tickFormat:function(a){return formatPotentialTimestamp(a)},rotateLabels:-25}}}function Preproc(a){return{replace:{"function":a}}}function Transformation(a,b){return{"function":a,args:b}}function Postproc(a,b,c,d,e){return{asyncEnd:{"function":a},transform:{"function":b,args:c,transformations:e},save:{"function":d}}}function Service(a,b,c,d,e){return{url:a,method:b,data:c,preproc:d,postproc:e}}function Callback(a,b,c,d,e){return new Service(a,b,c,d,e)}function SimpleQuery(a,b){return{inputtype:a,type:"Simple",datasource:{service:b}}}function AsyncQuery(a,b,c){return{inputtype:a,type:"Async",datasource:{service:b,callback:c}}}function Placeholder(a,b,c){return{key:a,value:b,isDynamic:c}}function TemplatePreset(a,b,c,d,e){return new Preset(a,new Template(b,c,d,e))}function Preset(a,b){return{name:a,preset:b}}function TemplatedQuery(a,b,c,d){return{inputtype:"Controls",controltype:a,type:b.type,datasource:b.datasource,paged:c,controls:d}}function Offset(a,b,c,d){return{vid:a,start:b,next:c,previous:d}}function Paging(a,b,c){return{ispaged:a,offsets:{first:b,second:c}}}function Controls(a){return{template:a}}function Template(a,b,c,d){return{templatedPayload:a,templatedParams:b,placeholders:c,queryTemplate:d}}function DefaultGlobalSettings(){return new GlobalSettings([{key:"__eId__",value:".*",isDynamic:!1}],!1,!1,"Global Settings",3e3)}function DefaultDashboardState(a){return a||(a=[]),new DashboardState(new DefaultGlobalSettings,a,"Viz Dashboard","aggregated",new DefaultDashboardGui)}function DefaultDashboard(a){return new Dashboard(getUniqueId(),new DefaultDashboardState(a))}function DefaultExplorationDashboard(){return new Dashboard(getUniqueId(),new DashboardState(new DefaultGlobalSettings,[new ExplorationDashlet],"Explore Dashboard","exploded",new DefaultDashboardGui))}function DefaultDashboardGui(){return new DashboardGui(!0)}function DefaultConfig(){return new Config("Off",!1,!1,"")}function DefaultQuery(){return new DefaultSimpleQuery}function DefaultSimpleQuery(){return new SimpleQuery("Raw",new DefaultService)}function DefaultAsyncQuery(){return new AsyncQuery("Raw",new DefaultService,new DefaultCallback)}function DefaultService(){return new Service("","Get","",new DefaultPreproc,new DefaultPostproc)}function DefaultCallback(){return new Callback("","Get","",new DefaultPreproc,new DefaultPostproc)}function DefaultPreproc(){return new Preproc(DefaultReplaceFunc())}function DefaultPostproc(){return new Postproc(DefaultAsyncEndFunc(),DefaultTransformFunc(),[],DefaultSaveFunct(),{})}function DefaultAsyncEndFunc(){return"function(response){\r	return response.myEndBoolean;\r}"}function DefaultTransformFunc(){return"function (response, args) {\r	return [];\r}"}function DefaultReplaceFunc(){return"function(requestFragment, workData){\r	for(i=0;i<workData.length;i++){\r		requestFragment = requestFragment.replace(workData[i].key, workData[i].value);\r	}\r	return requestFragment;\r}"}function DefaultSaveFunct(){return"function(response){\r	return [\r		{\r			key : '__mykey__', value : response.status, isDynamic : false\r		}\r	];\r}"}function DefaultInfo(){return new Info("Off")}function DefaultControls(a){return new Controls({})}function DefaultTemplate(a,b,c){return new Template("","",[])}function DefaultChartOptions(){return new ChartOptions("lineChart",!1,!1)}function DefaultDashletData(){return new DashletData([],{},{})}function DefaultGuiClosed(){return new Gui(!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1)}function DefaultGuiOpen(){return new Gui(!0,!1,!0,!0,!1,!0,!0,!1,!1,!0,!0,!0,!0,!0)}function DefaultDashletState(){return new DashletState("New Dashlet",!0,0,new DefaultDashletData,new DefaultChartOptions,new DefaultConfig,new DefaultQuery,new DefaultGuiClosed,new DefaultInfo)}function ExplorationDashletState(){return new DashletState("New Exploration Dashlet",!0,0,new DefaultDashletData,new DefaultChartOptions,new DefaultConfig,new DefaultQuery,new DefaultGuiOpen,new Info("On"))}function ExplorationDashlet(){return new Dashlet(getUniqueId(),new ExplorationDashletState)}function DefaultWidget(){return new Widget(getUniqueId(),new DefaultWidgetState,new DefaultDashletState)}function DefaultWidgetState(){return new WidgetState("col-md-6",!1,!0)}function DefaultPaging(){return new Paging("Off",{},{})}function IdIndexArray(a){if(!a)throw new Error("Please provide array ref as argument.");return{array:a,getId:function(a){return a.oid},addNew:function(a){var b=getUniqueId();return a.oid=b,this.array.push(a),b},addExisting:function(a){this.array.push(a)},clear:function(){this.array.length=0},getById:function(a){var b=this.getIndexById(a);if(-1===b)throw"No object found with Id:"+a;return this.array[b]},getByIndex:function(a){return this.array[a]},getIndexById:function(a){for(i=0;i<this.array.length;i++)if(this.array[i].oid===a)return i;return-1},getIdByIndex:function(a){return this.array[a].oid},removeById:function(a){this.array.splice(this.getIndexById(a),1)},removeByIndex:function(a){this.getIdByIndex(a);this.array.splice(a,1)},copyById:function(a){var b=jsoncopy(this.getById(a));return b.oid=getUniqueId(),b},duplicateById:function(a){var b=this.addExisting(this.copyById(a)),c=this.getIndexById(b),d=this.getIndexById(a);this.moveFromToIndex(c,d+1)},moveFromToIndex:function(a,b){this.array.splice(b,0,this.array.splice(a,1)[0])},count:function(){return this.array.length},getPrevious:function(a){return this.getByIndex(this.getIndexById(a)-1)},getPreviousId:function(a){return this.getId(this.getPrevious(a))},getNext:function(a){return this.getByIndex(this.getIndexById(a)+1)},getNextId:function(a){return this.getId(this.getNext(a))},addIfAbsent:function(a){if(!a.oid)return this.addNew(a);var b=this.getIndexById(a.oid);return 0>b?this.addExisting(a):b},removeIfExists:function(a){if(!a)throw"Cant remove object without proper oid";var b=this.getIndexById(a);return 0>b?-1:this.removeByIndex(b)},removeAll:function(){for(var a=0;a<this.array.length;a++)this.removeByIndex(a)},getAsArray:function(){return this.array}}}var productionmode=!0,productionFile="viz.js",devJSFolder="/js/",devTemplateFolder="/templates/",vizScripts={},registerScript=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src,c=b.split("/"),d=c[c.length-1];vizScripts[d]=b};registerScript();var forceRedraw=function(a){var b=a.$root.$$phase;"$apply"==b||"$digest"==b?a.$eval(function(){self.value=0}):a.$apply(function(){self.value=0})},resolveTemplateURL=function(a,b){return productionmode===!1?templateUrl=vizScripts[a].replace(devJSFolder,devTemplateFolder).replace(a,b)+"?who="+b+"&anticache="+getUniqueId():templateUrl=vizScripts[productionFile].replace(productionFile,"templates/"+b),templateUrl},setIntervalDefault=3e3,setIntervalAsyncDefault=500,keyvalarrayToIndex=function(a,b,c){var d={};return $.each(a,function(a,e){d[e[b]]=e[c]}),d},stringToColour=function(a){return a?intToColour(hashCode(a.toString())):"rgb(0,0,0)"},hashCode=function(a){var b,c,d=0;if(0===a.length)return d;for(b=0;b<a.length;b++)c=a.charCodeAt(b),d=(d<<5)-d+c,d|=0;return d},intToColour=function(a){var b=5e5*(a+1);a%2==0&&(b=100*b),b>>>=0;var c=255&b,d=(65280&b)>>>8,e=(16711680&b)>>>16;return"rgb("+[e,d,c].join(",")+")"},runResponseProc=function(postProc,args,response){return eval("("+postProc+")(response, args)")},runRequestProc=function(postProc,requestFragment,workData){return eval("("+postProc+")(requestFragment, workData)")},runValueFunction=function(functionFragment,value){return eval("(function(value){"+functionFragment+"})(value)")},runDynamicEval=function(expression){return eval(expression)},evalDynamic=function(a){var b=JSON.parse(JSON.stringify(a));return $.each(b,function(a,b){b.isDynamic&&(b.value=runDynamicEval(b.value))}),b},resolve=function(a,b){b=b.split(".");for(var c=a;b.length;){if("object"!=typeof c)return void 0;c=c[b.shift()]}return c},getUniqueId=function(){return Math.random().toString(36).substr(2,9)},jsoncopy=function(a){return JSON.parse(angular.toJson(a))},formatPotentialTimestamp=function(a){var b;return b="string"==typeof a?parseInt(a):a,b>=1e9&&2e9>b&&(b=1e3*b),b>=1e12&&2e12>b?d3.time.format("%H:%M:%S")(new Date(b)):a};registerScript(),angular.module("rtm-controls",[]).directive("rtmControls",function(){return{restrict:"E",scope:{state:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-controls.html"),controller:function(a,b){b.queryResult={abc:"def"}}}}),registerScript(),angular.module("viz-dashlet",["viz-query","dashletcomssrv"]).directive("vizDashlet",function(){var a="viz-dashlet.js",b=resolveTemplateURL(a,"viz-dashlet-aggregated.html"),c=resolveTemplateURL(a,"viz-dashlet-exploded.html"),d=resolveTemplateURL(a,"error-template.html");return{restrict:"E",scope:{widgetid:"=",state:"=",displaytype:"=",displaymode:"=",presets:"="},template:'<div ng-include="resolveDynamicTemplate()"></div>',controller:function(a,e,f){a.state.unwatchers=[],a.resolveDynamicTemplate=function(){return"aggregated"===a.displaytype?b:"exploded"===a.displaytype?c:d},a.selectTab=function(b){a.state.tabindex=b},a.isTabActive=function(b){return b===a.state.tabindex},a.messageBoxClick=function(){a.toggleBarchevronToConf(),a.selectTab(3),a.state.gui.status.open.info=!0},a.toggleBarchevronToConf=function(){a.state.viewtoggle=!a.state.viewtoggle},a.toggleBarchevronToViz=function(){a.fireQueryDependingOnContext(),a.state.viewtoggle=!a.state.viewtoggle},a.fireQueryDependingOnContext=function(){if(a.state.config.slave||"On"===a.state.config.autorefresh){if(a.state.data.rawresponse){var b=JSON.parse(angular.toJson(a.state.data.rawresponse));a.state.data.rawresponse=b}}else a.fireQuery()},a.cleanupState=function(){a.state.info.http.asynccheckpoint=!1,a.clearAsync(),a.$broadcast("cleanup-info"),a.isRawDisplay="On"===a.state.info.showraw},a.isOngoingQuery=!1,a.autorefreshInterval=void 0,a.fireQuery=function(){a.cleanupState();try{a.isOngoingQuery=!0;var b=a.state.query.datasource.service;b.params||(b.params=""),a.isRawDisplay&&(a.state.info.http.servicesent="url :"+JSON.stringify(b.url+b.params)+"; payload:"+JSON.stringify(b.data)),a.executeHttp(b.method,b.url+b.params,b.data,a.dispatchSuccessResponse,b,a.dispatchErrorResponse)}catch(c){a.sendErrorMessage("exception thrown while firing query: "+c)}},a.dispatchErrorResponse=function(b){"Simple"===a.state.query.type&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),"Async"===a.state.query.type&&(a.state.info.http.rawcallbackresponse=JSON.stringify(b)),a.sendErrorMessage("Query execution failed. Check error in service response for more details."),a.clearAsync(),a.isOngoingQuery=!1},a.sendErrorMessage=function(b){a.$broadcast("errormessage",b)},a.executeHttp=function(a,b,c,d,f,g){"Get"===a&&e.get(b).then(function(a){d(a,f)},function(a){g(a)}),"Post"===a&&e.post(b,c).then(function(a){d(a,f)},function(a){g(a)})},a.dispatchSuccessResponse=function(b,c){try{if("Simple"===a.state.query.type&&a.loadData(b,c),"Async"===a.state.query.type){a.state.info.http.asynccheckpoint=!0;var d=a.state.query.datasource.service,e=a.state.query.datasource.callback;a.isRawDisplay&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),a.state.query.datasource.service.postproc.save&&(a.state.data.state=runResponseProc(d.postproc.save["function"],null,b));var f=a.executeReplace(e,a.state.data.placeholdersstate);a.isRawDisplay&&(a.state.info.http.callbacksent="url :"+JSON.stringify(f.url)+"; payload:"+JSON.stringify(f.data));var g=function(){a.executeHttp(e.method,f.url,f.data,a.loadData,e,a.dispatchErrorResponse)};a.setAsyncInterval(g)}}catch(h){a.sendErrorMessage("An error occured while processing response:"+h),a.clearAsync(),a.isOngoingQuery=!1}},a.executeReplace=function(b,c){var d;c&&a.state.data.state?d=c.concat(a.state.data.state):(c&&(d=c),a.state.data.state&&(d=a.state.data.state));var e=b.data,f=b.url;if(b.preproc.replace&&b.preproc.replace["function"]){var g;if(e)try{g=runRequestProc(b.preproc.replace["function"],e,d),e=JSON.parse(g)}catch(h){a.sendErrorMessage("An issue occured while replacing payload data: "+h)}if(f)try{g=runRequestProc(b.preproc.replace["function"],f,d),f=g}catch(h){a.sendErrorMessage("An issue occured while replacing url params: "+h)}}return{data:e,url:f}},a.setAsyncInterval=function(b){a.clearAsync();var c=setIntervalAsyncDefault;a.state.config.asyncrefreshduration&&(c=a.state.config.asyncrefreshduration),a.asyncInterval=setInterval(b,c)},a.clearAsync=function(){a.asyncInterval&&clearInterval(a.asyncInterval)},a.loadData=function(b,c){if("Simple"===a.state.query.type&&(a.isRawDisplay&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),a.isOngoingQuery=!1),"Async"===a.state.query.type){if(a.asyncInterval)try{runResponseProc(a.state.query.datasource.callback.postproc.asyncEnd["function"],null,b)&&(a.clearAsync(),a.isOngoingQuery=!1)}catch(d){a.sendErrorMessage("An error occured while checking async response completeness"+d),a.clearAsync()}a.isRawDisplay&&(a.state.info.http.rawcallbackresponse=JSON.stringify(b))}a.state.data.rawresponse={dashdata:b}},a.state.unwatchers.push(a.$watch("state.data.rawresponse",function(b){var c=void 0;if("Simple"===a.state.query.type&&(c=a.state.query.datasource.service),"Async"===a.state.query.type&&(c=a.state.query.datasource.callback),c&&c.postproc&&b&&b.dashdata)if(c.postproc.transform["function"]&&c.postproc.transform["function"].length>0)try{a.state.data.transformed={dashdata:runResponseProc(c.postproc.transform["function"],keyvalarrayToIndex(evalDynamic(c.postproc.transform.args),"key","value"),b.dashdata)}}catch(d){a.sendErrorMessage("An error occured while performing transformation:"+d)}else a.sendErrorMessage("Warning: a new raw value was read by widget with id : "+a.widgetid+" but no transform function was provided")})),a.clearAutorefreshInterval=function(){a.autorefreshInterval&&clearInterval(a.autorefreshInterval)},a.state.unwatchers.push(a.$watch("state.config.autorefresh",function(b){a.clearAutorefreshInterval(),"On"===b&&a.setAutorefreshInterval()})),a.setAutorefreshInterval=function(){var b=setIntervalDefault;a.state.config.autorefreshduration&&(b=a.state.config.autorefreshduration),a.autorefreshInterval=setInterval(function(){if(!a.isOngoingQuery)try{a.fireQuery()}catch(b){a.sendErrorMessage("[Autorefresh] unable to refresh due to error: "+b+"; Starting new query."),a.isOngoingQuery=!1}},b)},a.$on("firequery",function(){a.fireQuery()}),a.$on("templateph-loaded",function(){a.state.query.controls&&a.state.query.controls.template&&a.state.query.paged.ispaged&&a.initPaging()}),a.$on("firenext",function(){a.nextPaging()}),a.$on("fireprevious",function(){a.previousPaging()}),a.$on("template-updated",function(){a.fireQuery()}),a.initPaging=function(){var b=a.state.query.paged;b&&b.offsets&&b.offsets.first&&(b.offsets.first.state=runValueFunction(b.offsets.first.start),b.offsets.second&&(b.offsets.second.state=runValueFunction(b.offsets.second.start))),a.$broadcast("update-template-nofire")},a.nextPaging=function(){var b=a.state.query.paged;b.offsets.first.state=runValueFunction(b.offsets.first.next,b.offsets.first.state),b.offsets.second.state=runValueFunction(b.offsets.second.next,b.offsets.second.state),a.$broadcast("update-template")},a.previousPaging=function(){var b=a.state.query.paged;b.offsets.first.state=runValueFunction(b.offsets.first.previous,b.offsets.first.state),b.offsets.second.state=runValueFunction(b.offsets.second.previous,b.offsets.second.state),a.$broadcast("update-template")},a.terminate=function(){console.log("["+a.widgetid+"] terminating..."),f.unregisterWidget(a.widgetid),a.clearAsync(),a.clearAutorefreshInterval(),a.state.config.autorefresh="Off",a.state.data={},a.state=null,console.log("["+a.widgetid+"] termination complete.")},a.unwatchAll=function(){$.each(a.state.unwatchers,function(a,b){b()})},a.state.viewtoggle||a.$on("dashletinput-initialized",function(){a.fireQueryDependingOnContext()}),a.$on("$destroy",function(){a.terminate()})}}}),registerScript(),angular.module("viz-mgd-widget",["viz-dashlet"]).directive("vizMgdWidget",function(){return{restrict:"E",scope:{displaymode:"=",widgetid:"=",wstate:"=",state:"=",headersheightinput:"=",charttocontainerinput:"=",presets:"="},templateUrl:resolveTemplateURL("viz-mgd-widget.js","viz-mgd-widget.html"),controller:function(a,b){a.computeHeights=function(){a.generalThicknessOffset=100,a.headersheight=a.headersheightinput,a.charttocontainerinput?a.charttocontainer=a.charttocontainerinput:a.charttocontainer=30;var b=window.innerHeight;a.chartHeightSmall=(b-a.headersheight-a.generalThicknessOffset)/2-a.charttocontainer,a.chartHeightBig=(b-a.headersheight-a.generalThicknessOffset)/1-a.charttocontainer,a.chartWidthSmall=0,a.chartWidthBig=0,a.innerContainerHeightSmall=(b-a.headersheight-a.generalThicknessOffset)/2,a.innerContainerHeightBig=(b-a.headersheight-a.generalThicknessOffset)/1,a.innerContainerWidthSmall=0,a.innerContainerWidthBig=0},a.getActualDashletWidth=function(){return b[0].children[0].children[0].offsetWidth},a.updateSize=function(){a.computeHeights();var b=.9*a.getActualDashletWidth(),c=a.state.options;c.chart.width=b,c.innercontainer.width=b-50,"col-md-6"===a.wstate.widgetwidth?(c.chart.height=a.chartHeightSmall,c.innercontainer.height=a.innerContainerHeightSmall):(c.chart.height=a.chartHeightBig,c.innercontainer.height=a.innerContainerHeightBig),a.state.savedHeight=a.state.options.innercontainer.height},a.startup=function(){a.state.options.innercontainer.height&&0!==a.state.options.innercontainer.height||$(document).ready(function(){a.resize()}),a.state.savedHeight=a.state.options.innercontainer.height,a.dashlettitle=a.state.title},a.startup(),a.toggleAutorefresh=function(){a.$broadcast("globalsettings-refreshToggle",{"new":!a.wstate.autorefresh})},a.$watch("state.config.autorefresh",function(b){"On"===b?a.wstate.autorefresh=!0:a.wstate.autorefresh=!1}),a.toggleChevron=function(){a.wstate.chevron?a.collapse():a.restore(),a.wstate.chevron=!a.wstate.chevron},a.saveDimensions=function(){a.state.savedHeight=a.state.options.innercontainer.height},a.collapse=function(){a.saveDimensions(),a.state.options.innercontainer.height=30},a.restore=function(){a.state.options.innercontainer.height=a.state.savedHeight},a.resize=function(){a.updateSize(),forceRedraw(a)},a.extend=function(){a.wstate.widgetwidth="col-md-12",$(document).ready(function(){a.resize()})},a.moveLeft=function(){a.$emit("mgdwidget-moveLeft",{wid:a.widgetid}),console.log("["+a.widgetid+"] moveLeft")},a.moveRight=function(){a.$emit("mgdwidget-moveRight",{wid:a.widgetid}),console.log("["+a.widgetid+"] moveRight")},a.reduce=function(){a.wstate.widgetwidth="col-md-6",a.aggressiveResize()},a.aggressiveResize=function(){$(document).ready(function(){a.resize(),a.agressiveRefresh()})},a.agressiveRefresh=function(){a.moveRight(),forceRedraw(a),a.moveLeft(),forceRedraw(a)},a.removeWidget=function(){a.$emit("mgdwidget-remove",{wid:a.widgetid})},a.$on("resize-widget",function(){a.resize()}),a.$on("dashlettitle-change",function(b,c){a.dashlettitle=c.newValue})}}}),registerScript(),angular.module("viz-query",["nvd3","ui.bootstrap","key-val-collection","rtm-controls"]).directive("vizQuery",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-query.html"),controller:function(a){}}}).directive("vizView",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-view.html"),controller:function(a){a.customheight&&(a.state.options.chart.height=customheight-10),a.state.unwatchers.push(a.$watch("state.data.transformed",function(b){b&&b.dashdata&&(a.state.options.chart.type.endsWith("seriesTable")&&(a.state.gui.tabledata=a.toTable(b.dashdata)),a.state.options.chart.type.endsWith("Chart")&&(a.state.gui.chartdata=a.toChart(b.dashdata))),"On"===a.state.info.showraw&&(a.state.info.transformresult=angular.toJson(b.dashdata))})),a.cleanupTooltips=function(){$("div.nvtooltip").remove()},a.formatPotentialTimestamp=function(a){return formatPotentialTimestamp(a)},a.stringToColour=function(a){return stringToColour(a)},a.isPagingOff=function(){return a.state.query.controls&&a.state.query.controls.template&&a.state.query.paged.ispaged?"Off"===a.state.query.paged.ispaged:!0},a.toChart=function(b){for(var c="x",d="y",e="z",f=[],g={},h=b,i=0;i<h.length;i++){var j=h[i][e];j in g||(f.push({values:[],key:j,color:a.stringToColour(j),strokeWidth:3,classed:"dashed"}),g[j]=f.length-1),f[g[j]].values.push({x:h[i][c],y:h[i][d]})}return f},a.toTable=function(a){for(var b="x",c="y",d="z",e=[],f={},g=[],h=a,i=0;i<h.length;i++){var j=h[i][b];j in f||(e.push({values:{},x:j}),f[j]=e.length-1),e[f[j]].values[h[i][d]]=h[i][c],g.includes(h[i][d])||g.push(h[i][d])}return{zlist:g.sort(),data:e}}}}}).directive("vizTransform",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-transform.html"),controller:function(a){}}}).directive("vizConfig",function(a){return{restrict:"E",scope:{widgetid:"=",state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-config.html"),controller:function(b){b.$on("globalsettings-refreshToggle",function(a,c){c["new"]?b.state.config.slave||(b.state.config.autorefresh="On"):b.state.config.autorefresh="Off"}),b.loadConfigPreset=function(a){b.state.config=jsoncopy(a)},b.loadMaster=function(a){b.$emit("master-loaded",a)},b.titleChange=function(){b.$emit("dashlettitle-change",{newValue:b.state.title})},b.titleChange(),b.undoMaster=function(){a.unregisterWidget(b.widgetid),b.unwatchMaster&&b.unwatchMaster()},b.undoSlave=function(){b.unwatchSlave&&b.unwatchSlave()},b.$on("coms-reset",function(){b.state.config.master&&(b.state.config.master=!b.state.config.master),b.undoMaster(),b.state.config.slave&&(b.state.config.slave=!b.state.config.slave),b.undoSlave()}),b.makeMaster=function(c){c?b.undoMaster():(a.registerWidget(b.widgetid,b.state.title),b.unwatchMaster=b.$watch("state.data.transformed",function(c){c?a.updateMasterValue(b.widgetid,{transformed:angular.toJson(c.dashdata),raw:angular.toJson(b.state.data.rawresponse.dashdata)}):console.log("Warning: a failed transformation occured, we are not broadcasting new value to slaves.")}))},b.$on("isMaster-changed",function(a,c){b.makeMaster(c)}),b.state.unwatchers.push(b.$watch("state.title",function(c){b.state.config.master&&a.udpdateTitle(b.widgetid,c)})),b.unwatchSlave="",b.startWatchingMaster=function(c){if(b.state.config.slave){var d=b.$watch(function(){return a.buffer[c]},function(a){if(a)try{if(b.state.config.target){var c=b.state.config.target;"state.data.transformed"===c&&(b.state.data.transformed={dashdata:JSON.parse(a.transformed)}),"state.data.rawresponse"===c&&(b.state.data.rawresponse={dashdata:JSON.parse(a.raw)})}else console.log("slave target is undefined.")}catch(d){console.log(d)}else console.log("Warning: an undefined newvalue has been read by slave with id:"+b.widgetid)});b.unwatchSlave=d}},b.state.unwatchers.push(b.$watch("state.config.slave",function(a){a||b.undoSlave()})),b.$on("master-loaded",function(a,c){b.undoSlave(),b.state.config.currentmaster=c,b.startWatchingMaster(c.oid)}),b.state.unwatchers.push(b.$watch(function(){return a.masters},function(a){b.state.config.masters=a})),b.$on("single-remove",function(a,c){c===b.widgetid&&b.prepareRemove()}),b.$on("global-remove",function(a,c){b.prepareRemove()}),b.prepareRemove=function(){b.state.config.master&&a.unregisterWidget(b.widgetid)},b.state.config.currentmaster&&$(document).ready(function(){b.startWatchingMaster(b.state.config.currentmaster.oid)}),b.state.config.master&&b.makeMaster(!1)}}}).directive("vizInfo",function(){return{restrict:"E",scope:{widgetid:"=",state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-info.html"),controller:function(a){a.errorboxcolor="gray",a.$on("cleanup-info",function(){a.state.info.http.rawserviceresponse="",a.state.info.http.rawcallbackresponse="",a.state.info.http.callbacksent="",a.state.info.http.servicesent=""}),a.sendSaveEvent=function(){a.$emit("dashlet-save",jsoncopy({oid:a.widgetid,state:a.state}))},a.sendCopyEvent=function(){a.$emit("dashlet-copy",jsoncopy({oid:a.widgetid,state:a.state}))},a.clearMessages=function(){a.state.info.alert.message="",a.state.info.alert.counter=0},a.$on("errormessage",function(b,c){a.state.info.alert.message=c+"\n\n"+a.state.info.alert.message,a.state.info.alert.counter++}),a.$on("clearmessages",function(){a.clearMessages()}),a.$watch("state.info.alert.counter",function(b){b>0?a.errorboxcolor="#ff7a00":a.errorboxcolor="gray"})}}}).directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return JSON.parse(a)}function f(a){return JSON.stringify(a)}d.$parsers.push(e),d.$formatters.push(f)}}}).directive("vizQService",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-service.html"),controller:function(a){a.initAsync=function(){var b=JSON.parse(angular.toJson(a.state.query.datasource.service));a.state.query=new DefaultAsyncQuery,a.state.query.datasource.service=b}}}}).directive("vizQInput",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-input.html"),controller:function(a){a.globalsettings=[],a.globalsettingschangeinit=!1,a.initControls=function(){a.state.query.controls=new DefaultControls,a.state.query.paged=new DefaultPaging},a.initTemplate=function(){a.state.query.controls.template=new DefaultTemplate},a.loadQueryPreset=function(b){var c=jsoncopy(b);a.state.query=c.query},a.$on("key-val-collection-change-Placeholders",function(b,c){a.templateplaceholders=c.collection,a.change(!1)}),a.processTemplate=function(b){var c="",d="";return a.state.data.placeholdersstate=evalDynamic(a.mergePlaceholders()),a.state.query.datasource.service.preproc.replace["function"]&&(a.state.query.controls.template.templatedPayload&&(c=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedPayload,a.state.data.placeholdersstate)),a.state.query.controls.template.templatedParams&&(d=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedParams,a.state.data.placeholdersstate))),{data:c,params:d}},a.updateLocalSettings=function(b){a.globalsettings=b.collection,a.state.query.controls&&a.state.query.controls.template&&a.change(b.async)},a.$on("globalsettings-change",function(b,c){a.updateLocalSettings(c)}),a.$on("globalsettings-change-init",function(b,c){a.globalsettingschangeinit&&a.globalsettingschangeinit!==!1||(a.updateLocalSettings(c),a.$emit("dashletinput-initialized"),a.globalsettingschangeinit=!0)}),a.mergePlaceholders=function(b){var c=JSON.parse(JSON.stringify(a.state.query.controls.template.placeholders)),d=JSON.parse(JSON.stringify(a.globalsettings)),e=[];return a.state.query.controls.template&&"On"===a.state.query.paged.ispaged&&(e.push({key:a.state.query.paged.offsets.first.vid,value:a.state.query.paged.offsets.first.state}),a.state.query.paged.offsets.second&&e.push({key:a.state.query.paged.offsets.second.vid,value:a.state.query.paged.offsets.second.state})),d.concat(c).concat(e)},a.loadTemplatePreset=function(b){var c=jsoncopy(b);a.state.query=c.queryTemplate,a.state.query.controls||(a.state.query.controls={template:{}}),a.state.query.controls.template.templatedPayload=c.templatedPayload,a.state.query.controls.template.templatedParams=c.templatedParams,a.state.query.controls.template.placeholders=c.placeholders,a.$emit("templateph-loaded")},a.$on("update-template-nofire",function(){a.change()}),a.$on("update-template",function(){a.change(),a.$emit("template-updated")}),a.change=function(b){var c=a.processTemplate();a.state.query.datasource.service.data=c.data,a.state.query.datasource.service.params=c.params},a.$emit("dashletinput-ready")}}}).directive("vizQPreproc",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-preproc.html"),controller:function(a){}}}).directive("vizQPostproc",function(){return{restrict:"E",scope:{state:"=",presets:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-postproc.html"),controller:function(a){}}}),registerScript(),angular.module("viz-dashboard",["viz-mgd-widget","ui.bootstrap","dashletcomssrv"]).directive("vizDashboard",function(){return{restrict:"E",scope:{dashboardid:"=",dstate:"=",displaymode:"=",displaytype:"=",presets:"=",topmargin:"="},templateUrl:resolveTemplateURL("viz-dashboard.js","viz-dashboard.html"),controller:function(a,b){a.toggleAutorefresh=function(){a.dstate.globalsettings.autorefresh=!a.dstate.globalsettings.autorefresh,a.dstate.globalsettings.autorefresh?a.addInterval():a.removeInterval(),a.$broadcast("globalsettings-refreshToggle",{"new":a.dstate.globalsettings.autorefresh})},a.addInterval=function(){var b=setIntervalDefault;a.dstate.globalsettings.intervalduration&&(b=a.dstate.globalsettings.intervalduration),a.removeInterval(),a.gsautorefreshInterval=setInterval(function(){a.$broadcast("globalsettings-change",{collection:a.dstate.globalsettings.placeholders,async:!0})},b)},a.removeInterval=function(){a.gsautorefreshInterval&&clearInterval(a.gsautorefreshInterval)},a.$on("key-val-collection-change-Global Settings",function(b,c){c.async=!1,a.$broadcast("globalsettings-change",c)}),a.$on("dashletinput-ready",function(){a.$broadcast("globalsettings-change-init",{collection:a.dstate.globalsettings.placeholders})}),a.toggleChevron=function(){a.dstate.globalsettings.chevron=!a.dstate.globalsettings.chevron},a.$on("mgdwidget-remove",function(b,c){a.wwrap.removeById(c.wid)}),a.$on("mgdwidget-moveLeft",function(b,c){var d=a.wwrap.getIndexById(c.wid);d>0&&a.wwrap.moveFromToIndex(d,d-1)}),a.$on("mgdwidget-moveRight",function(b,c){var d=a.wwrap.getIndexById(c.wid);d<a.wwrap.count()-1&&a.wwrap.moveFromToIndex(d,d+1)}),a.$on("mgdwidget-duplicate",function(b,c){a.wwrap.duplicateById(c.wid)}),a.$on("clearwidgets",function(b,c){a.dashboardid===c.dashboardid&&a.wwrap.clear()}),
a.$on("addwidget",function(b,c){a.dashboardid===c.dashboardid&&a.addWidget(c)}),a.addWidget=function(b){var c;b||(c=new DefaultWidget);a.wwrap.addNew(c)},$(window).on("resize",function(){a.$broadcast("resize-widget")}),a.onstartup=function(){a.wwrap=new IdIndexArray(a.dstate.widgets),a.gsautorefreshInterval=null,a.dstate.globalsettings.autorefresh&&a.toggleAutorefresh(),a.$broadcast("resize-widget"),a.$emit("dashboard-ready")},a.onstartup(),a.$watch("dstate.widgets",function(b){a.onstartup()}),a.$on("$destroy",function(){a.removeInterval()})}}}),registerScript(),angular.module("viz-dashboard-manager",["viz-dashboard","ui.bootstrap","dashletcomssrv"]).directive("vizDashboardManager",function(){return{restrict:"E",scope:{presets:"=",dashboards:"=",displaymode:"=",headermargin:"="},templateUrl:resolveTemplateURL("viz-dashboard.js","viz-dashboard-manager.html"),controller:function(a,b){a.headermargin?a.topmargin=a.headermargin:a.topmargin=b[0].getBoundingClientRect().top,a.init=!1,a.selectTab=function(b){a.mgrtabstate=b},a.isTabActive=function(b){return b===a.mgrtabstate},a.removeDashboard=function(b){a.mgrtabstate===b&&(a.dwrap.getIndexById(a.mgrtabstate)>0?a.mgrtabstate=a.dwrap.getPreviousId(a.mgrtabstate):a.dwrap.getIndexById(a.mgrtabstate)<a.dwrap.count()-1?a.mgrtabstate=a.dwrap.getNextId(a.mgrtabstate):a.mgrtabstate=null),a.dwrap.removeById(b)},a.$on("dashboard-new",function(b,c){var d;d=c&&c.displaytype&&"exploded"===c.displaytype?a.dwrap.addNew(new DefaultExplorationDashboard):a.dwrap.addNew(new DefaultDashboard),a.mgrtabstate=d}),a.$on("dashboard-clear",function(){a.dwrap.clear()}),a.$on("dashboard-current-addWidget",function(){var b=a.dwrap.getById(a.mgrtabstate),c=new IdIndexArray(b.dstate.widgets);c.addNew(new DefaultWidget)}),a.$on("dashboard-current-clearWidgets",function(){var b=a.dwrap.getById(a.mgrtabstate),c=new IdIndexArray(b.dstate.widgets);c.clear()}),a.$on("dashletinput-initialized",function(){a.init||(a.init=!0,a.$emit("manager-fully-loaded"))}),a.$on("dashlet-copy",function(b,c){a.clipboard=c}),a.$on("dashlet-paste",function(b){if(a.clipboard){var c=new Widget(getUniqueId(),new DefaultWidgetState,jsoncopy(a.clipboard.state)),d=a.dwrap.getById(a.mgrtabstate),e=new IdIndexArray(d.dstate.widgets);e.addNew(c)}}),a.onstartup=function(){a.dwrap=new IdIndexArray(a.dashboards),a.dashboards.length>0&&a.dashboards[0]&&a.dashboards[0].oid&&(a.mgrtabstate=a.dashboards[0].oid),a.$emit("manager-ready")},a.onstartup(),a.$watch("dashboards",function(b){a.onstartup()}),a.$watch("displaymode",function(b){a.$broadcast("resize-widget")})}}}),registerScript(),angular.module("key-val-collection",["ui.bootstrap"]).directive("keyValCollection",function(){return{restrict:"E",scope:{collection:"=",collectionname:"="},templateUrl:resolveTemplateURL("key-val-collection.js","key-val-collection.html"),controller:function(a){a.getNumber=function(a){return new Array(a)},a.addElement=function(){a.collection.push({key:"__?__",value:"?",isDynamic:!1}),a.changed()},a.removeElement=function(b){a.collection.splice(b,1),a.changed()},a.changed=function(b,c){a.$emit("key-val-collection-change-"+a.collectionname,{type:c,element:b,collection:a.collection})},a.$on("force-update-"+a.collectionname,function(b,c){a.$emit("key-val-collection-change-"+a.collectionname,{type:"forced",element:null,collection:a.collection})})}}}),registerScript(),angular.module("dashletcomssrv",[]).service("dashletcomssrv",function(a){var b={};return b.buffer={},b.masters={},b.masters.array=[],b.masters=new IdIndexArray(b.masters.array,function(a){}),b.registerWidget=function(a,c){b.masters.addIfAbsent({oid:a,title:c})},b.udpdateTitle=function(a,c){b.masters.getById(a).title=c},b.unregisterWidget=function(a){b.masters.removeIfExists(a)},b.updateMasterValue=function(a,c){b.buffer[a]=c},b}),registerScript(),angular.module("explore",["viz-dashlet"]).directive("explore",function(){return{restrict:"E",scope:{},templateUrl:resolveTemplateURL("explore.js","explore.html"),controller:function(a){a.state=new ExplorationDashletState,a.presets=new StaticPresets,a.resize=function(){a.state.options.chart.height=window.innerHeight/3},$(window).on("resize",function(){a.resize(),a.$apply(function(){self.value=0})}),a.resize()}}}),registerScript(),angular.module("viz",["viz-dashboard-manager"]).directive("viz",function(){return{restrict:"E",scope:{},templateUrl:resolveTemplateURL("viz.js","viz.html"),controller:function(a){a.staticPresetsInstance=new StaticPresets,a.dashboardsendpoint=[new DefaultDashboard([new DefaultWidget]),new DefaultExplorationDashboard],a.$on("top.dashboard-new",function(b,c){a.$broadcast("dashboard-new",c)}),a.$on("top.dashboard-clear",function(){a.$broadcast("dashboard-clear")}),a.$on("top.dashboard-current-addWidget",function(){a.$broadcast("dashboard-current-addWidget")}),a.$on("top.dashboard-current-clearWidgets",function(){a.$broadcast("dashboard-current-clearWidgets")}),a.$on("dashlet-save",function(b,c){a.dashboardsendpoint.push(new DefaultDashboard([new Widget(getUniqueId(),new DefaultWidgetState,c.state)]))})}}});