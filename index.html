<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="img/favicon.png">

<title>nvd3 + bootstrap grid</title>
<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="bower_components/angular/angular.js"></script>
<script src="bower_components/d3/d3.js"></script>
<script src="bower_components/nvd3/build/nv.d3.js"></script>
<script src="bower_components/angular-nvd3/dist/angular-nvd3.js"></script>
<script src="bower_components/angular-bootstrap/ui-bootstrap.js"></script>
<script src="bower_components/bootstrap/bootstrap/dist/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="bower_components/nvd3/build/nv.d3.css">
<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.css">
<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
<style>
.glyphicon {
    color: red;
    text-shadow: 1px 1px 1px #ccc;
    font-size: 1.5em;
}
.glyphicon:hover {
    color: black;
    text-shadow: 1px 1px 1px #ccc;
    font-size: 1.5em;
}

</style>
</head>

<body>


<script>
var myApp = angular.module('myApp', ['nvd3', 'ui.bootstrap']);

       myApp.controller('myCtrl', function($scope){

    
    $scope.widgets = [];

    $scope.elemVals = {};
    $scope.parentScrollable = true;
    $scope.parentRelative = true;

    $scope.getValues = function() {
      var divEl = $window.document.querySelector('#posdemodiv');
      var btnEl = $window.document.querySelector('#posdemobtn');

      var offsetParent = $uibPosition.offsetParent(divEl);
      $scope.elemVals.offsetParent = 'type: ' + offsetParent.tagName + ', id: ' + offsetParent.id;

      var scrollParent = $uibPosition.scrollParent(divEl);
      $scope.elemVals.scrollParent = 'type: ' + scrollParent.tagName + ', id: ' + scrollParent.id;

      $scope.scrollbarWidth = $uibPosition.scrollbarWidth();

      $scope.elemVals.position = $uibPosition.position(divEl);

      $scope.elemVals.offset = $uibPosition.offset(divEl);

      $scope.elemVals.viewportOffset = $uibPosition.viewportOffset(divEl);

      $scope.elemVals.positionElements = $uibPosition.positionElements(btnEl, divEl, 'auto bottom-left');
    };
    
    
    $scope.clearWidgets = function() {
    	$scope.widgets = [];
    };
    
    
    $scope.extendWidget = function(wId) {
    		for(i=0; i<$scope.widgets.length; i++){
				if($scope.widgets[i].widgetId === wId){
					$scope.widgets[i].widgetWidth = 'col-md-12';
					$scope.widgets[i].options.chart.height = 500;
					$scope.widgets[i].options.chart.width = 1000;
				}
			}
    };
    
        $scope.reduceWidget = function(wId) {
    		for(i=0; i<$scope.widgets.length; i++){
				if($scope.widgets[i].widgetId === wId){
					$scope.widgets[i].widgetWidth = 'col-md-6';
					$scope.widgets[i].options.chart.height = 250;
					$scope.widgets[i].options.chart.width = 500;
				}
			}
    };
    
    $scope.addWidget = function() {
    	
    	wId = Math.random().toString(36).substr(2, 9);
    	
    	widget = {
    	  widgetId : wId,
    	  widgetWidth : 'col-md-6',
    	  options :  new DefaultChartOptions(),
          title: {
                enable: true,
                text: 'Title for Line Chart'
            	 },
    	  data : sinAndCos()
    	};
    	
    	$scope.widgets.push(widget);
    	
    	console.log(widget);
    	};
    	
    	$scope.removeWidget = function(wId){
    	
			for(i=0; i<$scope.widgets.length; i++){
				if($scope.widgets[i].widgetId === wId)
					$scope.widgets.splice(i,i+1);
			}
		};
    	
        /*Random Data Generator */
        function sinAndCos() {
            var sin = [],sin2 = [],
                cos = [];

            //Data is represented as an array of {x,y} pairs.
            for (var i = 0; i < 100; i++) {
                sin.push({x: i, y: Math.sin(i/10)});
                sin2.push({x: i, y: i % 10 == 5 ? null : Math.sin(i/10) *0.25 + 0.5});
                cos.push({x: i, y: .5 * Math.cos(i/10+ 2) + Math.random() / 10});
            }

            //Line chart data should be sent as an array of series objects.
            return [
                {
                    values: sin,      //values - represents the array of {x,y} data points
                    key: 'Sine Wave', //key  - the name of the series.
                    color: '#ff7f0e',  //color - optional: choose your own line color.
                    strokeWidth: 2,
                    classed: 'dashed'
                },
                {
                    values: cos,
                    key: 'Cosine Wave',
                    color: '#2ca02c'
                },
                {
                    values: sin2,
                    key: 'Another sine wave',
                    color: '#7777ff',
                    area: true      //area - set to true if you want this line to turn into a filled area chart.
                }
            ];
        };
        
        function DefaultChartOptions(){
        	return {
        		chart: {
              	  type: 'lineChart',
                	height: 250,
                	width: 500,
                	margin : {
                    	top: 20,
                    	right: 20,
                    	bottom: 40,
                    	left: 55
                	},
                	x: function(d){ return d.x; },
                	y: function(d){ return d.y; },
                	useInteractiveGuideline: true,
                	dispatch: {
                    	stateChange: function(e){ console.log("stateChange"); },
                    	changeState: function(e){ console.log("changeState"); },
                    	tooltipShow: function(e){ console.log("tooltipShow"); },
                    	tooltipHide: function(e){ console.log("tooltipHide"); }
                	},
                	xAxis: {
                    	axisLabel: 'Time (ms)'
                	},
                	yAxis: {
                    	axisLabel: 'Voltage (v)',
                    	tickFormat: function(d){
                        	return d3.format('.02f')(d);
                    	},
                    	axisLabelDistance: -10
                	},
                	callback: function(chart){
                    	console.log("!!! lineChart callback !!!");
                	}
                	}
                };
        };

	});
</script>

<div ng-app='myApp'>
    <div ng-controller='myCtrl'>
    
    
    <div class="container">

      <div class="page-header">
        <h1>nvd3 + bootstrap grid on angularJS</h1>
        <p class="lead">Basic grid layout for charts.</p>
      </div>
      
        <div>
            <a class="btn btn-primary" ng-click="addWidget()" href="#">Add Widget</a>
            <a class="btn btn-primary" ng-click="clearWidgets()" href="#">Clear Widgets</a>
        </div>

      <div class="row">
      	<div ng-repeat="o in widgets">	
      		<!--<span> wId={{o.widgetId}};</span><span>width={{o.widgetWidth}};</span><span>cWidth={{o.options.chart.width}};</span>-->
      		<div ng-if="o.widgetWidth == 'col-md-6'">
      		 <div class='col-md-6'>
      				<span class="glyphicon glyphicon-arrow-right" ng-click="extendWidget(o.widgetId)" href="#" style="float: right"></span>
      				<span class="glyphicon glyphicon-remove" ng-click="removeWidget(o.widgetId)" href="#" style="float: right"></span>
      				<nvd3 options='o.options' data='o.data' style="text-align: center; justify-content: center;"></nvd3>
      			</div>
      		</div>
      		<div ng-if="o.widgetWidth == 'col-md-12'">
      		 <div class='col-md-12'>
      				<span class="glyphicon glyphicon-arrow-left" ng-click="reduceWidget(o.widgetId)" href="#" style="float: right"></span>
      				<span class="glyphicon glyphicon-remove" ng-click="removeWidget(o.widgetId)" href="#" style="float: right"></span>
      				<nvd3 options='o.options' data='o.data'  style="text-align: center; justify-content: center;"></nvd3>
      			</div>
      		</div>
            
      	</div>
        
      </div>
      

    </div>
    
   

    
</div>


</body>
</html>
